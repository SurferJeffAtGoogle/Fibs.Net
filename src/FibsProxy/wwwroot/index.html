<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Welcome to FibsFun!</title>
</head>
<body>
  <form id="loginForm">
    <div><span>user: <input id="user" /></span></div>
    <div><span>password: <input id="password" type="password" /></span></div>
    <div><input id="loginButton" type="submit" value="Login" /></div>
  </form>
  <form id="logoutForm">
    <div><span>status:</span><span id="socketStatus">closed</span></div>
    <div><input id="logoutButton" type="submit" value="Logout" /></div>
  </form>

  <script>
    var socket = null;

    window.onload = function () {
      $("#loginForm").onsubmit = function (e) {
        var user = $("#user").value;
        var password = $("#password").value;

        socket = new WebSocket("ws://" + window.location.host + "/fibs");
        socket.onopen = function (e) {
          socket.send("login " + user + " " + password);
          $("#socketStatus").innerText = "logging in as " + user;
        };

        socket.onclose = function (e) {
          socket = null;
          $("#socketStatus").innerText = "closed";
        };

        socket.onmessage = function (e) {
          process(e.data);
        };

        socket.onerror = function (e) {
          dump("Error: " + e.data);
        };

        e.preventDefault();
        e.cancelBubble = true;
      };

      $("#logoutForm").onsubmit = function (e) {
        socket.close();
        e.preventDefault();
        e.cancelBubble = true;
      };

    };

    function process(json) {
      var data = JSON.parse(json);

    }

    function dump(s) {
      var p = document.createElement("p");
      p.innerHTML = s;
      $("#dump").appendChild(p);
    }

    function $(selector) { return document.querySelector(selector); }
    function $$(selector) { return document.querySelectorAll(selector); }
  </script>
</body>
</html>
