<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="fibs-motd">
  <template>
    <template is="dom-repeat" items="[[lines]]" as="line">
      <p>{{line}}</p>
    </template>
  </template>

  <script>
    Polymer({
      is: "fibs-motd",

      properties: {
        lines: {
          type: Array,
          value: function () { return []; }
        },
      },

      ready: function () {
        this._app = document.querySelector("fibs-app");
        this.listen(this._app, "CLIP_MOTD_BEGIN", "_onMotdReset");
        this.listen(this._app, "FIBS_MOTD", "_onMotdLine");
        this.listen(this._app, "FIBS_Closed", "_onMotdReset");
        this.listen(this._app, "socket-status-changed", "_socketStatusChanged");
      },

      _onMotdReset: function () {
        this.set("lines", []);
      },

      _socketStatusChanged: function () {
        if (this._app.socketStatus == "closed") { this._onMotdReset(); }
      },

      _onMotdLine: function (e) {
        // strip all of the ASCII box stuff from around the MOTD
        var line = e.detail.message.trim();
        if (line.startsWith("+")) { return; }
        if (line.startsWith("|")) { line = line.substr(1); }
        if (line.endsWith("|")) { line = line.substr(0, line.length - 1); }
        line = line.trim();
        if (line == "") { return; }
        this.push("lines", line);
      },

    });
  </script>
</dom-module>